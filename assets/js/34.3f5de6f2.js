(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{388:function(a,s,t){"use strict";t.r(s);var r=t(42),e=Object(r.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"crontab-计划任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#crontab-计划任务"}},[a._v("#")]),a._v(" Crontab 计划任务")]),a._v(" "),t("ul",[t("li",[a._v("https://crontab.guru/")])]),a._v(" "),t("h2",{attrs:{id:"选择1-宿主机运行-crontab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#选择1-宿主机运行-crontab"}},[a._v("#")]),a._v(" 选择1：宿主机运行 crontab")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("crontab")]),a._v(" -e\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("* * * * * /usr/local/bin/docker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -i "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v(" docker container "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" --format "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{{.ID}}'")]),a._v(" -f "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("label")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("com.khs1994.com -f "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("label")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("com.docker.compose.service"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("php7 "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" -c "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"php /app/path-to-your-project/artisan schedule:run >> /dev/null 2>&1"')]),a._v("\n\n* * * * * /usr/local/bin/docker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -i "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v(" docker container "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" --format "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{{.ID}}'")]),a._v(" -f "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("label")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("com.khs1994.com -f "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("label")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("com.docker.swarm.service.name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("lnmp_php7 "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" -c "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"php /app/path-to-your-project/artisan schedule:run >> /dev/null 2>&1"')]),a._v("\n")])])]),t("p",[a._v("通过在 "),t("strong",[a._v("宿主机")]),a._v(" 计划执行 "),t("code",[a._v("docker exec ***")]),a._v("，变相实现容器内计划任务，只适用于 "),t("strong",[a._v("单机环境")]),a._v("。")]),a._v(" "),t("h2",{attrs:{id:"选择2-容器内运行-crontab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#选择2-容器内运行-crontab"}},[a._v("#")]),a._v(" 选择2：容器内运行 crontab")]),a._v(" "),t("p",[a._v("使用 "),t("code",[a._v("s6")]),a._v(" 或 "),t("RouterLink",{attrs:{to:"/supervisord.html"}},[a._v("supervisord")])],1),a._v(" "),t("h2",{attrs:{id:"alpine-非-root-用户无法运行-crontab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#alpine-非-root-用户无法运行-crontab"}},[a._v("#")]),a._v(" Alpine 非 root 用户无法运行 crontab")]),a._v(" "),t("ul",[t("li",[a._v("https://github.com/gliderlabs/docker-alpine/issues/381")]),a._v(" "),t("li",[a._v("https://github.com/inter169/systs/blob/master/alpine/crond/README.md")])])])}),[],!1,null,null,null);s.default=e.exports}}]);