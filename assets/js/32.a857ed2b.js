(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{387:function(t,s,_){"use strict";_.r(s);var e=_(42),v=Object(e.a)({},(function(){var t=this,s=t.$createElement,_=t._self._c||s;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"软件配置"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#软件配置"}},[t._v("#")]),t._v(" 软件配置")]),t._v(" "),_("p",[t._v("自定义软件配置是最重要的一项功能，为了方便本项目升级，严禁直接修改 "),_("code",[t._v("./config")]),t._v(" 下的原始配置文件。")]),t._v(" "),_("p",[t._v("下面详细介绍如何正确的自定义配置。")]),t._v(" "),_("h2",{attrs:{id:"原则"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#原则"}},[t._v("#")]),t._v(" 原则")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("以追加(子配置文件 "),_("strong",[t._v("重写")]),t._v(" 主配置文件、后边的 "),_("strong",[t._v("重写")]),t._v(" 前边的)方式进行配置")])]),t._v(" "),_("li",[_("p",[t._v("尽量一个软件一个配置文件")])])]),t._v(" "),_("h2",{attrs:{id:"总体步骤-三步"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#总体步骤-三步"}},[t._v("#")]),t._v(" 总体步骤（三步）")]),t._v(" "),_("p",[_("strong",[t._v("1.")]),t._v(" 进入配置文件所在目录 "),_("code",[t._v("./config/SOFT_NAME/")])]),t._v(" "),_("p",[_("strong",[t._v("2.")]),t._v(" 复制示例配置文件，并改名为 "),_("code",[t._v("*.my.*")]),t._v("。（"),_("code",[t._v("my")]),t._v(" 只是标识符，你可以使用任意字符，例如 "),_("code",[t._v("self")]),t._v(" "),_("code",[t._v("username")]),t._v(" 等等）。")]),t._v(" "),_("p",[_("strong",[t._v("3.")]),t._v(" 修改 "),_("code",[t._v(".env")]),t._v(" 文件 "),_("code",[t._v("SOFT_NAME_CONF")]),t._v(" 值为文件名或目录名")]),t._v(" "),_("h2",{attrs:{id:"mysql"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[t._v("#")]),t._v(" MySQL")]),t._v(" "),_("p",[_("strong",[t._v("1.")]),t._v(" 示例配置文件："),_("code",[t._v("./config/mysql/conf.d/docker.cnf")])]),t._v(" "),_("p",[_("strong",[t._v("2.")]),t._v(" 在示例配置文件夹内 "),_("code",[t._v("./config/mysql")]),t._v(" 复制 "),_("code",[t._v("conf.d")]),t._v(" 为 "),_("code",[t._v("conf.my.d")])]),t._v(" "),_("p",[_("strong",[t._v("3.")]),t._v(" 在 "),_("code",[t._v(".env")]),t._v(" 文件内修改 "),_("code",[t._v("LNMP_MYSQL_CONF_D")]),t._v(" 变量值为 "),_("code",[t._v("conf.my.d")])]),t._v(" "),_("blockquote",[_("p",[t._v("Windows 用户注意事项")])]),t._v(" "),_("div",{staticClass:"language-bash extra-class"},[_("pre",{pre:!0,attrs:{class:"language-bash"}},[_("code",[_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nmysqld: "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Warning"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" World-writable config "),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/etc/mysql/conf.d/docker.cnf'")]),t._v(" is ignored.\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),_("p",[t._v("由于 MySQL 会检查配置文件权限（如上），在 Windows 使用的开发者，首先请执行如下命令修改配置文件权限")]),t._v(" "),_("div",{staticClass:"language-bash extra-class"},[_("pre",{pre:!0,attrs:{class:"language-bash"}},[_("code",[t._v("$ docker "),_("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mysql 容器 ID"),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n\n$ "),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("644")]),t._v(" -R /etc/mysql/conf.d\n\n$ ./lnmp-docker restart mysql\n")])])]),_("h3",{attrs:{id:"修改默认数据文件夹"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#修改默认数据文件夹"}},[t._v("#")]),t._v(" 修改默认数据文件夹")]),t._v(" "),_("p",[t._v("假设你想把数据放到为 "),_("code",[t._v("/var/lib/mysql-my")])]),t._v(" "),_("p",[t._v("在 "),_("code",[t._v("conf.my.d/my.cnf")]),t._v(" （新建该文件）中增加如下配置")]),t._v(" "),_("div",{staticClass:"language-bash extra-class"},[_("pre",{pre:!0,attrs:{class:"language-bash"}},[_("code",[_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mysqld"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ndatadir         "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /var/lib/mysql-my\n")])])]),_("p",[t._v("在 "),_("code",[t._v(".env")]),t._v(" 文件中修改 "),_("code",[t._v("LNMP_MYSQL_DATA=/var/lib/mysql-my")]),t._v(",之后启动即可。")]),t._v(" "),_("blockquote",[_("p",[t._v("MariaDB 配置差不多，这里不再赘述。")])]),t._v(" "),_("h3",{attrs:{id:"mysql-自定义初始的-root-密码"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#mysql-自定义初始的-root-密码"}},[t._v("#")]),t._v(" MySQL 自定义初始的 ROOT 密码")]),t._v(" "),_("h4",{attrs:{id:"通过密钥文件设置密码-自行了解设置"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#通过密钥文件设置密码-自行了解设置"}},[t._v("#")]),t._v(" 通过密钥文件设置密码（自行了解设置）")]),t._v(" "),_("p",[_("strong",[t._v("1.")]),t._v(" 在 "),_("code",[t._v("./secrets/")]),t._v(" 新建 "),_("code",[t._v("*.txt")]),t._v(" 文件，并写入密码。例如 "),_("code",[t._v("db.my.txt")])]),t._v(" "),_("p",[_("strong",[t._v("2.")]),t._v(" 在 "),_("code",[t._v(".env")]),t._v(" 文件中设置 "),_("code",[t._v("LNMP_DB_ROOT_PASSWORD_PATH")]),t._v(" 值为文件名，例如 "),_("code",[t._v("LNMP_DB_ROOT_PASSWORD_PATH=db.my.txt")])]),t._v(" "),_("h4",{attrs:{id:"通过修改-env-文件修改密码-默认"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#通过修改-env-文件修改密码-默认"}},[t._v("#")]),t._v(" 通过修改 .env 文件修改密码（默认）")]),t._v(" "),_("div",{staticClass:"language-diff extra-class"},[_("pre",{pre:!0,attrs:{class:"language-diff"}},[_("code",[_("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[_("span",{pre:!0,attrs:{class:"token prefix deleted"}},[t._v("-")]),_("span",{pre:!0,attrs:{class:"token line"}},[t._v(" LNMP_MYSQL_ROOT_PASSWORD=mytest\n")])]),_("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[_("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),_("span",{pre:!0,attrs:{class:"token line"}},[t._v(" LNMP_MYSQL_ROOT_PASSWORD=newpassword\n")])]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[_("span",{pre:!0,attrs:{class:"token prefix deleted"}},[t._v("-")]),_("span",{pre:!0,attrs:{class:"token line"}},[t._v(" LNMP_MYSQL_DATABASE=test\n")])]),_("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[_("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),_("span",{pre:!0,attrs:{class:"token line"}},[t._v(" LNMP_MYSQL_DATABASE=mydb\n")])])])])]),_("blockquote",[_("p",[t._v("如果 MySQL 之前启动过，要么销毁（数据卷）之后重新启动，要么手动进入命令行修改密码。")])]),t._v(" "),_("h2",{attrs:{id:"nginx-httpd"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#nginx-httpd"}},[t._v("#")]),t._v(" NGINX HTTPD")]),t._v(" "),_("p",[t._v("这两个软件的配置文件较多，详细说明一下：")]),t._v(" "),_("p",[_("strong",[t._v("1.")]),t._v(" 分清 "),_("code",[t._v("主配置文件")]),t._v(" 和 "),_("code",[t._v("子配置文件")]),t._v("，本文假设你已经知道这两个概念，如果你实在不知道，请在本项目 GitHub 提出 "),_("code",[t._v("issue")])]),t._v(" "),_("p",[_("strong",[t._v("2.")]),t._v(" NGINX 主配置文件位于 "),_("code",[t._v("./config/etc/nginx/nginx.conf")]),t._v("，同理 HTTPD 主配置文件位于 "),_("code",[t._v("./config/etc/httpd/httpd.conf")])]),t._v(" "),_("p",[_("strong",[t._v("3.")]),t._v(" 复制 "),_("code",[t._v("nginx.conf")]),t._v(" 为 "),_("code",[t._v("nginx.my.conf")]),t._v("，HTTPD 同理")]),t._v(" "),_("p",[_("strong",[t._v("4.")]),t._v(" 在 "),_("code",[t._v("./config")]),t._v(" 目录中新建 "),_("code",[t._v("nginx.my")]),t._v(" 文件夹，HTTPD 新建 "),_("code",[t._v("httpd.my")]),t._v(" 文件夹")]),t._v(" "),_("p",[_("strong",[t._v("5.")]),t._v(" 我们以后就在 "),_("code",[t._v("nginx.my")]),t._v(" 文件夹内新增 NGINX 子配置文件（请参照 "),_("code",[t._v("nginx")]),t._v(" 文件中的示例配置），HTTPD 同理。为了方便备份配置文件，可以在 "),_("code",[t._v("./config/nginx.my")]),t._v(" 文件夹中初始化一个 Git 仓库，通过 Git 管理配置文件。当你切换到另一个环境中，你可以很方便的通过 git clone url 快速恢复配置文件。")]),t._v(" "),_("p",[_("strong",[t._v("6.")]),t._v(" 修改 "),_("code",[t._v(".env")]),t._v(" 文件 "),_("code",[t._v("LNMP_NGINX_CONF=nginx.my.conf")]),t._v(" "),_("code",[t._v("LNMP_NGINX_CONF_D=nginx.my")]),t._v("，HTTPD 同理")]),t._v(" "),_("h2",{attrs:{id:"简单的自定义-php-ini-配置"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#简单的自定义-php-ini-配置"}},[t._v("#")]),t._v(" 简单的自定义 "),_("code",[t._v("php.ini")]),t._v(" 配置")]),t._v(" "),_("p",[t._v("编辑 "),_("code",[t._v("./config/php/docker-php.ini")]),t._v(" 文件。")]),t._v(" "),_("blockquote",[_("p",[t._v("当你需要更改大量的 "),_("code",[t._v("php.ini")]),t._v(" 配置时，请编辑 "),_("code",[t._v("./config/php/php.ini")])])]),t._v(" "),_("blockquote",[_("p",[t._v("php.ini 支持系统变量 "),_("code",[t._v("key=${VAR}")]),t._v("，故可以通过设置系统变量来自定义配置")])]),t._v(" "),_("h2",{attrs:{id:"其他软件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#其他软件"}},[t._v("#")]),t._v(" 其他软件")]),t._v(" "),_("p",[t._v("不再赘述，如果你还是实在不知道该怎么正确的自定义配置，请在本项目 GitHub 提出 "),_("code",[t._v("issue")]),t._v("。")])])}),[],!1,null,null,null);s.default=v.exports}}]);