(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{448:function(s,t,a){"use strict";a.r(t);var n=a(42),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nfs-volume-nfsv4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nfs-volume-nfsv4"}},[s._v("#")]),s._v(" NFS Volume(NFSv4)")]),s._v(" "),a("p",[a("strong",[s._v("NFS 数据卷")]),s._v(" 是跨主机的容器数据存储方案之一。")]),s._v(" "),a("h2",{attrs:{id:"nfs-各个版本的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nfs-各个版本的区别"}},[s._v("#")]),s._v(" NFS 各个版本的区别")]),s._v(" "),a("ul",[a("li",[s._v("https://blog.csdn.net/ycnian/article/details/8515517")])]),s._v(" "),a("p",[s._v("本文以 "),a("code",[s._v("NFSv4")]),s._v(" 版本为例，无需开启 RPC "),a("code",[s._v("111")]),s._v(" 端口, 只需开启 "),a("code",[s._v("2049")]),s._v(" 端口即可。")]),s._v(" "),a("h2",{attrs:{id:"配置-nfs-server-容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-nfs-server-容器"}},[s._v("#")]),s._v(" 配置 NFS Server 容器")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("kubernetes/nfs-server/.env")]),s._v(" 文件中配置")]),s._v(" "),a("p",[a("code",[s._v("NFS_EXPORT_N")]),s._v(" 变量值为容器中 "),a("code",[s._v("/etc/exports")]),s._v(" 中的每一行")]),s._v(" "),a("p",[s._v("部分设置项解释")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/home/work "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,fsid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",insecure,sync,no_root_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /home/work 192.168.1.0/24(rw,fsid=0,insecure,sync,no_root_squash)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /home/work *(rw,fsid=0,insecure,sync,no_root_squash)")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同一目录的访问规则请写在同一行")]),s._v("\n")])])]),a("p",[a("code",[s._v("rw")]),s._v(" read-write 可读写;注意，仅仅这里设置成读写客户端还是不能正常写入，还要正确地设置共享目录的权限，参考问题7")]),s._v(" "),a("p",[a("code",[s._v("ro")]),s._v(" read-only 只读；")]),s._v(" "),a("p",[a("code",[s._v("sync")]),s._v(" 文件同时写入硬盘和内存；")]),s._v(" "),a("p",[a("code",[s._v("async")]),s._v(" 文件暂存于内存，而不是直接写入内存；")]),s._v(" "),a("p",[a("code",[s._v("no_root_squash")]),s._v(" NFS 客户端连接服务端时如果使用的是 root 的话，那么对服务端分享的目录来说，也拥有 root 权限。显然开启这项是不安全的。")]),s._v(" "),a("p",[a("code",[s._v("root_squash")]),s._v(" NFS 客户端连接服务端时如果使用的是 root 的话，那么对服务端分享的目录来说，拥有匿名用户权限，通常他将使用 nobody 或 nfsnobody 身份；")]),s._v(" "),a("p",[a("code",[s._v("all_squash")]),s._v(" 不论 NFS 客户端连接服务端时使用什么用户，对服务端分享的目录来说都是拥有匿名用户权限；")]),s._v(" "),a("p",[a("code",[s._v("anonuid")]),s._v(" 匿名用户的 UID 值，通常是 nobody 或 nfsnobody，可以在此处自行设定；")]),s._v(" "),a("p",[a("code",[s._v("anongid")]),s._v(" 匿名用户的 GID 值。")]),s._v(" "),a("p",[a("code",[s._v("subtree_check")]),s._v("（默认） 若输出目录是一个子目录，则nfs服务器将检查其父目录的权限；\n"),a("code",[s._v("no_subtree_check")]),s._v(" 即使输出目录是一个子目录，nfs服务器也不检查其父目录的权限，这样可以提高效率；")]),s._v(" "),a("p",[a("code",[s._v("insecure")])]),s._v(" "),a("h3",{attrs:{id:"fsid-0"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fsid-0"}},[s._v("#")]),s._v(" "),a("code",[s._v("fsid=0")])]),s._v(" "),a("p",[a("code",[s._v("NFSv4")]),s._v(" 文件系统的命令空间发生了变化，服务器端必须设置一个根文件系统("),a("code",[s._v("fsid=0")]),s._v(")，其他文件系统挂载在根文件系统上导出。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/home  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".78.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,fsid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",insecure,sync,no_root_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#导出虚拟根目录")]),s._v("\n\n/home/nfs  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".78.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,insecure,sync,no_root_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#导出虚拟根下的子目录1")]),s._v("\n\n/home/data  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".78.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,insecure,sync,no_root_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#导出虚拟根下的子目录2")]),s._v("\n")])])]),a("h2",{attrs:{id:"客户端挂载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端挂载"}},[s._v("#")]),s._v(" 客户端挂载")]),s._v(" "),a("p",[s._v("安装依赖")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y nfs-common\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y nfs-utils\n")])])]),a("p",[s._v("挂载")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" -t nfs4 -v -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".78.1:/nfs   /tmp/nfs\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" -t nfs4 -v -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".78.1:/data  /tmp/data\n")])])]),a("p",[a("code",[s._v("-o")]),s._v(" 所支持的参数请通过 "),a("code",[s._v("$ man nfs")]),s._v(" 查看")]),s._v(" "),a("h2",{attrs:{id:"客户端支持的-nfs-版本-o-vers-4-2-与-linux-内核有关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端支持的-nfs-版本-o-vers-4-2-与-linux-内核有关"}},[s._v("#")]),s._v(" 客户端支持的 NFS 版本 (-o vers=4.2) 与 Linux 内核有关")]),s._v(" "),a("ul",[a("li",[s._v("https://github.com/torvalds/linux/blob/master/fs/nfs/Kconfig")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONFIG_NETWORK_FILESYSTEMS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONFIG_NFS_FS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONFIG_NFS_V2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONFIG_NFS_V3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CONFIG_NFS_V3_ACL is not set")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONFIG_NFS_V4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CONFIG_NFS_SWAP is not set")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CONFIG_NFS_V4_1 is not set")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CONFIG_NFS_V4_2 is not set")]),s._v("\n")])])]),a("p",[s._v("使用以上参数编译的 Linux 内核不支持 NFS "),a("code",[s._v("4.1")]),s._v(" "),a("code",[s._v("4.2")]),s._v(",添加以下编译参数即可:")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONFIG_NFS_V4_1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONFIG_NFS_V4_2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /lib/modules/"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -r"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("/modules.builtin "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nfs\n\n$ zcat /proc/config.gz "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" NFS\n")])])]),a("h2",{attrs:{id:"加载内核模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加载内核模块"}},[s._v("#")]),s._v(" 加载内核模块")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" modprobe "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("nfs,nfsd,rpcsec_gss_krb5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h2",{attrs:{id:"容器运行-nfs-服务端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器运行-nfs-服务端"}},[s._v("#")]),s._v(" 容器运行 NFS 服务端")]),s._v(" "),a("ul",[a("li",[s._v("https://github.com/ehough/docker-nfs-server")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" kubernetes/nfs-server\n\n$ docker compose up "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" nfs\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者可以直接执行")]),s._v("\n$ lnmp-docker nfs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("down"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("p",[s._v("或者执行 "),a("code",[s._v("$ docker run XXX")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exports.txt")]),s._v("\n/nfs *"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,fsid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",insecure,no_root_squash,no_subtree_check"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/nfs/data *"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,insecure,no_root_squash,no_subtree_check"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ docker run -it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v /nfs:/nfs:rw "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2049")]),s._v(":2049 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PWD")]),s._v("}")]),s._v("/exports.txt:/etc/exports:ro "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NFS_DISABLE_VERSION_3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --cap-add SYS_ADMIN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --privileged "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    erichough/nfs-server\n")])])]),a("h2",{attrs:{id:"宿主机安装-nfs-服务端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#宿主机安装-nfs-服务端"}},[s._v("#")]),s._v(" 宿主机安装 NFS 服务端")]),s._v(" "),a("ul",[a("li",[s._v("https://help.ubuntu.com/community/SettingUpNFSHowTo")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y --no-install-recommends nfs-kernel-server kmod libcap2-bin\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nfs-utils rpcbind\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start nfs\n")])])]),a("p",[s._v("编辑 "),a("code",[s._v("/etc/exports")]),s._v(" 文件")]),s._v(" "),a("h2",{attrs:{id:"nfs-客户端尝试挂载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nfs-客户端尝试挂载"}},[s._v("#")]),s._v(" NFS 客户端尝试挂载")]),s._v(" "),a("ul",[a("li",[s._v("客户端必须确保 RPC 协议相应的 portmap 正常运行，否则 mount 将失败 (NFSv3 Only)")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $ systemctl start rpcbind.service")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $ showmount -e ${SERVER_IP:-192.168.199.100} # nfs4 not support")]),s._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /cli-nfs\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虽然服务端指定的是 /nfs 这里对应为 /")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 必须通过 -t 指定类型，默认为 nfs3 (根据操作系统的不同默认挂载类型也不同)")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" -v -t nfs4 -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(",proto"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp,port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2049")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVER_IP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v("192.168.199.100}")]),s._v(":/ /cli-nfs\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v("\n")])])]),a("h2",{attrs:{id:"容器挂载-nfs-volume"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器挂载-nfs-volume"}},[s._v("#")]),s._v(" 容器挂载 NFS Volume")]),s._v(" "),a("ul",[a("li",[s._v("https://docs.docker.com/storage/volumes/#choose-the--v-or---mount-flag")]),s._v(" "),a("li",[s._v("https://docs.docker.com/storage/volumes/#create-a-service-which-creates-an-nfs-volume")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 NFS 数据卷")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Docker 桌面版 支持 vers=4.2")]),s._v("\n$ docker volume create volume-nfs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -d "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nfs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("device")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".199.100:/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("o")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".199.100,vers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(",soft,timeo"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180")]),s._v(",bg,tcp,rw\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载")]),s._v("\n$ docker container run -it --rm "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --mount "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type=volume,src=volume-nfs,dst=/data"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    busybox "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者在 --mount 中直接配置")]),s._v("\n$ docker container run -it --rm "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      --mount "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'type=volume,src=volume-nfs,dst=/data,volume-driver=local,volume-opt=type=nfs,volume-opt=device=192.168.199.100:/,\"volume-opt=o=addr=192.168.199.100,vers=4,soft,timeo=180,bg,tcp,rw\"'")]),s._v(" busybox "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n")])])]),a("p",[s._v("支持哪些 NFS 版本 "),a("code",[s._v("4.2")]),s._v(" "),a("code",[s._v("4.1")]),s._v(" "),a("code",[s._v("4")]),s._v(" 与宿主机一致,可以在宿主机使用 "),a("code",[s._v("$ sudo mount -t nfs4 -v XXX")]),s._v(" 进行测试")]),s._v(" "),a("p",[s._v("宿主机不支持 "),a("code",[s._v("4.2")]),s._v(", "),a("code",[s._v("$ docker run")]),s._v(" 指定 "),a("code",[s._v("vers=4.2")]),s._v(" 也会出错")]),s._v(" "),a("h2",{attrs:{id:"compose-中使用-nfs-volume"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compose-中使用-nfs-volume"}},[s._v("#")]),s._v(" Compose 中使用 NFS volume")]),s._v(" "),a("p",[s._v("请查看 "),a("code",[s._v("scripts/docker-example.yml")]),s._v(" 文件的 "),a("code",[s._v("volumes")]),s._v(" 部分")]),s._v(" "),a("h2",{attrs:{id:"windows-10-挂载-nfs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#windows-10-挂载-nfs"}},[s._v("#")]),s._v(" Windows 10 挂载 NFS")]),s._v(" "),a("ul",[a("li",[s._v("https://docs.microsoft.com/en-us/windows-server/storage/nfs/nfs-overview#windows-and-windows-server-versions")])]),s._v(" "),a("p",[a("strong",[s._v("只支持 NFSv2, NFSv3")])]),s._v(" "),a("h2",{attrs:{id:"more-information"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#more-information"}},[s._v("#")]),s._v(" More Information")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("https://blog.csdn.net/xuplus/article/details/51669063")])]),s._v(" "),a("li",[a("p",[s._v("https://blog.csdn.net/bbwangj/article/details/78599038")])]),s._v(" "),a("li",[a("p",[s._v("https://blog.csdn.net/younger_china/article/details/52175085")])]),s._v(" "),a("li",[a("p",[s._v("https://github.com/kubernetes/examples/blob/master/staging/volumes/nfs/nfs-server-deployment.yaml")])]),s._v(" "),a("li",[a("p",[s._v("https://www.cnblogs.com/lykyl/archive/2013/06/14/3136921.html")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);