(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{388:function(t,a,s){"use strict";s.r(a);var r=s(42),e=Object(r.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"crontab-计划任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#crontab-计划任务"}},[t._v("#")]),t._v(" Crontab 计划任务")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://cloud.tencent.com/act/cps/redirect?redirect=10058&cps_key=3a5255852d5db99dcd5da4c72f05df61",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"https://img.shields.io/badge/AD-%E8%85%BE%E8%AE%AF%E4%BA%91%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1-blue.svg",alt:""}}),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"https://cloud.tencent.com/developer/support-plan?invite_code=13vokmlse8afh",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"https://img.shields.io/badge/Support-%E8%85%BE%E8%AE%AF%E4%BA%91%E8%87%AA%E5%AA%92%E4%BD%93-brightgreen.svg",alt:""}}),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[t._v("https://crontab.guru/")])]),t._v(" "),s("h2",{attrs:{id:"选择1-宿主机运行-crontab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选择1-宿主机运行-crontab"}},[t._v("#")]),t._v(" 选择1：宿主机运行 crontab")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("crontab")]),t._v(" -e\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("* * * * * /usr/local/bin/docker "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -i "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v(" docker container "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" --format "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{{.ID}}'")]),t._v(" -f "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("label")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("com.khs1994.com -f "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("label")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("com.docker.compose.service"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("php7 "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" -c "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"php /app/path-to-your-project/artisan schedule:run >> /dev/null 2>&1"')]),t._v("\n\n* * * * * /usr/local/bin/docker "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -i "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v(" docker container "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" --format "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{{.ID}}'")]),t._v(" -f "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("label")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("com.khs1994.com -f "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("label")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("com.docker.swarm.service.name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("lnmp_php7 "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" -c "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"php /app/path-to-your-project/artisan schedule:run >> /dev/null 2>&1"')]),t._v("\n")])])]),s("p",[t._v("通过在 "),s("strong",[t._v("宿主机")]),t._v(" 计划执行 "),s("code",[t._v("docker exec ***")]),t._v("，变相实现容器内计划任务，只适用于 "),s("strong",[t._v("单机环境")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"选择2-容器内运行-crontab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选择2-容器内运行-crontab"}},[t._v("#")]),t._v(" 选择2：容器内运行 crontab")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("s6")]),t._v(" 或 "),s("RouterLink",{attrs:{to:"/supervisord.html"}},[t._v("supervisord")])],1),t._v(" "),s("h2",{attrs:{id:"alpine-非-root-用户无法运行-crontab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#alpine-非-root-用户无法运行-crontab"}},[t._v("#")]),t._v(" Alpine 非 root 用户无法运行 crontab")]),t._v(" "),s("ul",[s("li",[t._v("https://github.com/gliderlabs/docker-alpine/issues/381")]),t._v(" "),s("li",[t._v("https://github.com/inter169/systs/blob/master/alpine/crond/README.md")])])])}),[],!1,null,null,null);a.default=e.exports}}]);