(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{229:function(t,s,e){"use strict";e.r(s);var n=e(0),a=Object(n.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),e("p",[e("a",{attrs:{href:"https://cloud.tencent.com/redirect.php?redirect=10058&cps_key=3a5255852d5db99dcd5da4c72f05df61",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://img.shields.io/badge/AD-%E8%85%BE%E8%AE%AF%E4%BA%91%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1-blue.svg",alt:""}}),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://cloud.tencent.com/developer/support-plan?invite_code=13vokmlse8afh",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://img.shields.io/badge/Support-%E8%85%BE%E8%AE%AF%E4%BA%91%E8%87%AA%E5%AA%92%E4%BD%93-brightgreen.svg",alt:""}}),e("OutboundLink")],1)]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),e("p",[t._v("部分设置项解释")]),t._v(" "),t._m(8),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._m(16),t._v(" "),t._m(17),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._m(22),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"nfs-volume"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nfs-volume","aria-hidden":"true"}},[this._v("#")]),this._v(" NFS Volume")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("NFS 数据卷")]),this._v(" 是跨主机的容器数据存储方案之一。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"nfs-各个版本的区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nfs-各个版本的区别","aria-hidden":"true"}},[this._v("#")]),this._v(" NFS 各个版本的区别")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("https://blog.csdn.net/ycnian/article/details/8515517")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("本文以 "),s("code",[this._v("NFSv4")]),this._v(" 版本为例，无需 RPC "),s("code",[this._v("111")]),this._v(" 端口, 只需监听 "),s("code",[this._v("2049")]),this._v(" 端口即可。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"配置-ip-段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-ip-段","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置 IP 段")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在 "),s("code",[this._v("volumes/.env")]),this._v(" 文件中配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("NFS_EXPORT_N")]),this._v(" 变量值为容器中 "),s("code",[this._v("/etc/exports")]),this._v(" 中的每一行")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("/home/work 192.168.0.*"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rw,fsid"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("0,insecure,sync,no_root_squash"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /home/work 192.168.1.0/24(rw,fsid=0,insecure,sync,no_root_squash)")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /home/work *(rw,fsid=0,insecure,sync,no_root_squash)")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 同一目录的访问规则请写在同一行，上边只是列出规则的写法")]),t._v("\n\nrw：read-write，可读写"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("注意，仅仅这里设置成读写客户端还是不能正常写入，还要正确地设置共享目录的权限，参考问题7\nro：read-only，只读；\n\nsync：文件同时写入硬盘和内存；\nasync：文件暂存于内存，而不是直接写入内存；\n\nno_root_squash：NFS 客户端连接服务端时如果使用的是 root 的话，那么对服务端分享的目录来说，也拥有 root 权限。显然开启这项是不安全的。\nroot_squash：NFS 客户端连接服务端时如果使用的是 root 的话，那么对服务端分享的目录来说，拥有匿名用户权限，通常他将使用 nobody 或 nfsnobody 身份；\nall_squash：不论 NFS 客户端连接服务端时使用什么用户，对服务端分享的目录来说都是拥有匿名用户权限；\n\nanonuid：匿名用户的 UID 值，通常是 nobody 或 nfsnobody，可以在此处自行设定；\nanongid：匿名用户的 GID 值。\n\nno_subtree_check:\ninsecure:\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"fsid-0"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fsid-0","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("fsid=0")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("NFSv4")]),this._v(" 文件系统的命令空间发生了变化，服务器端必须设置一个根文件系统(fsid=0)，其他文件系统挂载在根文件系统上导出。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("/home  192.168.78.0/24"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rw,fsid"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("0,insecure,sync,no_root_squash"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#导出虚拟根目录")]),t._v("\n\n/home/nfs  192.168.78.0/24"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rw,insecure,sync,no_root_squash"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#导出虚拟根下的子目录1")]),t._v("\n\n/home/data  192.168.78.0/24"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rw,insecure,sync,no_root_squash"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#导出虚拟根下的子目录2")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 客户端对应的挂载命令如下")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" -t nfs4 192.168.78.1:/nfs   /tmp/nfs\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" -t nfs4 192.168.78.1:/data  /tmp/data\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"加载内核模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#加载内核模块","aria-hidden":"true"}},[this._v("#")]),this._v(" 加载内核模块")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("sudo")]),this._v(" modprobe "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("{")]),this._v("nfs,nfsd,rpcsec_gss_krb5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("}")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"容器运行-nfs-服务端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器运行-nfs-服务端","aria-hidden":"true"}},[this._v("#")]),this._v(" 容器运行 NFS 服务端")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" volumes\n\n$ docker-compose up "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-d"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" nfs "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or $ lnmp-docker nfs [down]")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("https://github.com/ehough/docker-nfs-server")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$ docker run -it \\\n    -v /nfs:/nfs:rw \\\n    -p 2049:2049 \\\n    -e NFS_EXPORT_0"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/nfs *(rw,fsid=0,insecure,no_root_squash,no_subtree_check)'")]),t._v("  \\\n    -e NFS_EXPORT_1"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/nfs/data *(rw,insecure,no_root_squash,no_subtree_check)'")]),t._v("  \\\n    -e NFS_DISABLE_VERSION_3"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1 \\\n    --cap-add SYS_ADMIN \\\n    --privileged \\\n    erichough/nfs-server\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("NFSv3 port "),s("code",[this._v("111")]),this._v(" "),s("code",[this._v("20048")])]),this._v(" "),s("li",[s("code",[this._v("--privileged")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"系统安装-nfs-服务端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统安装-nfs-服务端","aria-hidden":"true"}},[this._v("#")]),this._v(" 系统安装 NFS 服务端")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("https://help.ubuntu.com/community/SettingUpNFSHowTo")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("sudo")]),this._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("apt")]),this._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("install")]),this._v(" -y --no-install-recommends nfs-kernel-server kmod libcap2-bin\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("sudo")]),this._v(" yum "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("install")]),this._v(" nfs-utils rpcbind\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("sudo")]),this._v(" systemctl start nfs\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("自行编辑 "),s("code",[this._v("/etc/exports")]),this._v(" 文件")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"nfs-客户端尝试挂载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nfs-客户端尝试挂载","aria-hidden":"true"}},[this._v("#")]),this._v(" NFS 客户端尝试挂载")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("客户端必须确保 RPC 协议相应的 portmap 正常运行，否则 mount 将失败 (NFSv3 Only)")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $ systemctl start rpcbind.service")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $ showmount -e ${SERVER_IP:-192.168.199.100} # nfs4 not support")]),t._v("\n\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /nfs\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 虽然服务端指定的是 /nfs 这里对应为 /")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 必须通过 -t 指定类型，默认为 nfs3")]),t._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" -v -t nfs4 -o proto"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tcp,port"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("2049 "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${SERVER_IP:-192.168.199.100}")]),t._v(":/ /nfs\n\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"容器挂载-nfs-volume"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器挂载-nfs-volume","aria-hidden":"true"}},[this._v("#")]),this._v(" 容器挂载 NFS Volume")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("https://docs.docker.com/storage/volumes/#choose-the--v-or---mount-flag")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$ docker volume create volume-nfs \\\n    -d local \\\n    -o type"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nfs \\\n    -o device"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("192.168.199.100:/ \\\n    -o o"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("addr"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("192.168.199.100,vers"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("4,soft,timeo"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("180,bg,tcp,rw\n\n$ docker container run -it --rm \\\n    --mount "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type=volume,src=volume-nfs,dst=/data"')]),t._v(" \\\n    busybox sh\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $ docker container run -it --rm \\")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# --mount 'type=volume,src=volume-nfs,dst=/data,volume-driver=local,volume-opt=type=nfs,volume-opt=device=192.168.199.100:/,\"volume-opt=o=addr=192.168.199.100,vers=4,soft,timeo=180,bg,tcp,rw\"' busybox sh")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"compose-中使用-nfs-volume"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#compose-中使用-nfs-volume","aria-hidden":"true"}},[this._v("#")]),this._v(" Compose 中使用 NFS volume")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("请查看 "),s("code",[this._v("docker-example.yml")]),this._v(" 文件的 "),s("code",[this._v("volumes")]),this._v(" 部分")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"more-information"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#more-information","aria-hidden":"true"}},[this._v("#")]),this._v(" More Information")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("https://blog.csdn.net/xuplus/article/details/51669063")])]),this._v(" "),s("li",[s("p",[this._v("https://blog.csdn.net/bbwangj/article/details/78599038")])]),this._v(" "),s("li",[s("p",[this._v("https://blog.csdn.net/younger_china/article/details/52175085")])]),this._v(" "),s("li",[s("p",[this._v("https://github.com/kubernetes/examples/blob/master/staging/volumes/nfs/nfs-server-rc.yaml")])])])}],!1,null,null,null);s.default=a.exports}}]);